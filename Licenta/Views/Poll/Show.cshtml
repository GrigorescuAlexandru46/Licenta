@model Licenta.Models.Poll

<script>
    window.onload = function () {
        var inputLink = document.getElementById("inputLink");

        inputLink.value = getURL();
    }

    function copyToClipboard() {
        var inputLink = document.getElementById("inputLink");
        var copyButton = document.getElementById("copyButton")

        inputLink.select();
        document.execCommand("copy");
        inputLink.blur();

        copyButton.classList.remove("btn-info");
        copyButton.classList.add("btn-success");
        copyButton.innerHTML = "Link copied !";
    }

    function getURL() {
        return window.location.protocol + "//" + window.location.host + "/Poll/Fill/" + "@(Model.PollId)";
    }
</script>

@{
    ViewBag.Title = Model.Name;
    int i = 1;
}

@if (ViewBag.Message != null)
{
    <div class="alert alert-dismissible alert-success">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <p>@ViewBag.message</p>
    </div>
}

<h1>@ViewBag.Title</h1>
<hr />

<div class="panel panel-primary">
    <div class="panel-heading">Poll details</div>

    <div class="panel-body">
        <div class="row">
            <label class="col-lg-2 control-label">Title :</label>
            <label class="col-lg-2 control-label">@Model.Name</label>
        </div>
        <div class="row">
            <label class="col-lg-2 control-label">Creator :</label>
            @Html.ActionLink(Model.Profile.FirstName + " " + Model.Profile.LastName, "Show", "Profile", new { id = Model.Profile.ProfileId }, new { @class = "btn-link col-lg-2" })
        </div>
        <div class="row">
            <label class="col-lg-2 control-label">Poll creation date :</label>
            <label class="col-lg-2 control-label">@Model.CreationDate</label>
        </div>
        @if (ViewBag.PollIsActive == true)
        {
            <div class="row">
                <label class="col-lg-2 control-label">Poll state :</label>
                <label class="col-lg-2 control-label text-success">Active</label>
            </div>

            <div class="row">
                <hr />
            </div>

            <div class="row">
                <label class="col-lg-4 control-label">Link where the poll can be filled :</label>
            </div>

            <div class="row">
                <div class="col-lg-3">
                    <input type="text" class="form-control" id="inputLink">
                </div>
                <div class="col-lg-6">
                    <button class="btn btn-info" onclick="copyToClipboard()" id="copyButton">Copy link</button>
                </div>
            </div>

            <div class="row">
                <br /><hr />
            </div>

            <div class="row">
                <div class="col-lg-3 col-lg-offset-4">
                    @Html.ActionLink("Show results", "Results", "Poll", new { id = Model.PollId }, new { @class = "btn btn-success btn-block" })
                </div>
            </div>
        }
        else
        {
            <div class="row">
                <label class="col-lg-2 control-label">Poll state :</label>
                <label class="col-lg-2 control-label text-danger">Inactive</label>
            </div>

            <div class="row">
                <hr />
            </div>

            <div class="row">
                <div class="col-lg-3 col-lg-offset-4">
                    @Html.ActionLink("Show results", "Results", "Poll", new { id = Model.PollId }, new { @class = "btn btn-success btn-block" })
                </div>
            </div>

        }


    </div>
</div>

<ul class="list-group">
    <li class="list-group-item active">
        <h4 class="list-group-item-heading">Questions</h4>
    </li>

    @foreach (var question in Model.Questions)
    {
    <li class="list-group-item">
        <div class="row">
            <div class="col-lg-12">
                <h4>@(i++). <span>&nbsp;</span> @question.Text</h4>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                @if (question.QuestionType == 1)
                {
                    <h6>Choose a single answer.</h6>
                }
                else if (question.QuestionType == 2)
                {
                    <h6>Choose one or more answers.</h6>
                }
            </div>
        </div>
        @if (question.QuestionType != 3)
        {
            foreach (var answer in question.Answers)
            {
                <div class="row">
                    <div class="col-lg-11 col-lg-offset-1">
                        @if (question.QuestionType == 1)
                        {
                            <span class="glyphicon glyphicon-asterisk">&nbsp;</span>
                        }
                        else
                        {
                            <span class="glyphicon glyphicon-unchecked">&nbsp;</span>
                        }
                        <span>@answer.Text</span>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="row">
                <div class="col-lg-12">
                    <span>&nbsp;</span>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <textarea class="form-control" disabled="" placeholder="Type your answer here" rows="1" style="max-width: 100%; width: 24%; min-height: 42px"></textarea>
                </div>
            </div>
        }
        <div class="row">
            <div class="col-lg-12">
                <span>&nbsp;</span>
            </div>
        </div>
    </li>
    }


</ul>

@if (ViewBag.UserIsProfileOwner || ViewBag.UserIsAdmin)
{
    <div class="row">
        <div class="col-md-2">
            @if (ViewBag.PollIsActive == true)
            {
                @Html.ActionLink("Edit poll", "Edit", "Poll", new { id = Model.PollId }, new { @class = "btn btn-info btn-block disabled" })
            }
            else
            {
                @Html.ActionLink("Edit poll", "Edit", "Poll", new { id = Model.PollId }, new { @class = "btn btn-info btn-block" })
            }

        </div>
        <div class="col-md-4 col-md-offset-2">
            @if (ViewBag.PollIsActive == true)
            {
                @Html.ActionLink("Stop poll", "ConfirmStop", "Poll", new { id = Model.PollId }, new { @class = "btn btn-warning btn-block" })
            }
            else
            {
                @Html.ActionLink("Start poll", "ConfirmStart", "Poll", new { id = Model.PollId }, new { @class = "btn btn-success btn-block" })
            }

        </div>
        <div class="col-md-2 col-md-offset-2">
            <form action="/poll/delete/@Model.PollId" method="post">
                @Html.HttpMethodOverride(HttpVerbs.Delete)
                @if (ViewBag.PollIsActive == true)
                {
                    <button type="submit" class="btn btn-danger btn-block disabled">Delete poll</button>
                }
                else
                {
                    <button type="submit" class="btn btn-danger btn-block">Delete poll</button>
                }
            </form>
        </div>
    </div>
}


